{
  "name": "OpenCnabPHP",
  "tagline": "Projeto para gerar remessa e processar retorno nos layouts cnab240 e 400",
  "body": "# OpenCnabPHP\r\nProjeto para gerar remessa e processar retorno nos layouts cnab240 e 400<br>\r\nNovo projeto orientado a objeto com três níveis de hierarquia\r\n<ul>\r\n<li>\r\nUm arquivo remessaAbstract cuida das questões sobre arquivos em geral.\r\n</li>\r\n<li>\r\nA classe para cada Remessa herda remssaAbstract e seta o nome do banco que é a pasta para os layouts personalizados\r\n</li>\r\n<li>\r\nRegitroAbstract cuida de metodos unicos para qualquer registro de qualquer layout,\r\n</li>\r\n<li>\r\nUma classe genérico herda registroAbstract e implementa setters e getters comuns ao registro de um determinado layout\r\n</li>\r\ne por fim uma classe registro herda de genérico e define o layout que sera usado e se por ventura for necessario sobrepõe ou implementa novos getters e setters do arquivo generico.\r\n</li><br>\r\n\r\n## Utilizando docker:\r\nEsteja na raiz do projeto e execute:\r\n```shell\r\ndocker-compose up -d\r\n```\r\nAcesse a url de exemplo: \r\n`http://localhost:8080/src/samples/ExemploRemessa.php`\r\n\r\n<table>\r\n    <tr>\r\n        <td colspan=\"3\">\r\n            REMESSA\r\n        </td>\r\n        <td colspan=\"2\">\r\n            RETORNO\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            Banco\r\n        </td>\r\n        <td>\r\n            Layout\r\n        </td>\r\n        <td>\r\n           Situação \r\n        </td>\r\n        <td>\r\n            Layout\r\n        </td>\r\n        <td>\r\n           Situação \r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            Caixa\r\n        </td>\r\n        <td>\r\n            Cnab240_SIGCB\r\n        </td>\r\n        <td>\r\n            Homologado\r\n        </td>\r\n        <td>\r\n            Cnab240_SIGCB\r\n        </td>\r\n        <td>\r\n            aguardando voluntario para teste\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            Itau\r\n        </td>\r\n        <td>\r\n            Cnab240\r\n        </td>\r\n        <td>\r\n            Beta\r\n        </td>\r\n        <td>\r\n            Cnab240\r\n        </td>\r\n        <td>\r\n            Beta\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            Itau\r\n        </td>\r\n        <td>\r\n            Cnab400\r\n        </td>\r\n        <td>\r\n            Homologado\r\n        </td>\r\n        <td>\r\n            Cnab400\r\n        </td>\r\n        <td>\r\n            Beta\r\n        </td>\r\n    </tr>\r\n</table>\r\n\r\n```php\r\n<?php\r\nuse \\CnabPHP\\Remessa;\r\n\r\n$arquivo = new Remessa('Caixa','cnab240_SIGCB',array(\r\n    'nome_empresa' =>\"Empresa ABC\", // seu nome de empresa\r\n    'tipo_inscricao'  => 2, // 1 para cpf, 2 cnpj \r\n    'numero_inscricao' => $empresa->empresas_cnpjcpf, // seu cpf ou cnpj completo\r\n    'agencia'       => '1234', // agencia sem o digito verificador \r\n    'agencia_dv'    => 1, // somente o digito verificador da agencia \r\n    'conta'         => '12345', // número da conta\r\n    'conta_dac'     => 1, // digito da conta\r\n    'codigo_beneficiario'     => '123456', // codigo fornecido pelo banco\r\n    'numero_sequencial_arquivo'     => 1, // sequencial do arquivo um numero novo para cada arquivo gerado\r\n));\r\n$lote  = $arquivo->addLote(array('tipo_servico'=> 1)); // tipo_servico  = 1 para cobrança registrada, 2 para sem registro\r\n\r\n$lote->inserirDetalhe(array(\r\n    'codigo_ocorrencia' => 1, //1 = Entrada de título, para outras opçoes ver nota explicativa C004 manual Cnab_SIGCB na pasta docs\r\n    'nosso_numero'      => 1, // numero sequencial de boleto\r\n    'seu_numero'        => 1,// se nao informado usarei o nosso numero \r\n\r\n    /* campos necessarios somente para itau cnab400, não precisa comentar se for outro layout    */\r\n    'carteira_banco'    => 109, // codigo da carteira ex: 109,RG esse vai o nome da carteira no banco\r\n    'cod_carteira'      => \"I\", // I para a maioria ddas carteiras do itau\r\n    /* campos necessarios somente para itau, não precisa comentar se for outro layout   */\r\n    \r\n    'especie_titulo'    => \"DM\", // informar dm e sera convertido para codigo em qualquer laytou conferir em especie.php\r\n    'valor'             => 100.00, // Valor do boleto como float valido em php\r\n    'emissao_boleto'        => 2, // tipo de emissao do boleto informar 2 para emissao pelo beneficiario e 1 para emissao pelo banco\r\n    'protestar'        => 2, // 1 = Protestar com (Prazo) dias, 2 = Devolver após (Prazo) dias\r\n    'nome_pagador'      => \"JOSÉ da SILVA ALVES\", // O Pagador é o cliente, preste atenção nos campos abaixo\r\n    'tipo_inscricao'    => 1, //campo fixo, escreva '1' se for pessoa fisica, 2 se for pessoa juridica\r\n    'numero_inscricao'  => '123.122.123-56',//cpf ou ncpj do pagador\r\n    'endereco_pagador'  => 'Rua dos developers,123 sl 103',\r\n    'bairro_pagador'     => 'Bairro da insonia',\r\n    'cep_pagador'        => '12345-123', // com hífem\r\n    'cidade_pagador'     => 'Londrina',\r\n    'uf_pagador'         => 'PR',\r\n    'data_vencimento'    => '2016-04-09', // informar a data neste formato\r\n    'data_emissao'       => '2016-04-09', // informar a data neste formato\r\n    'vlr_juros'          => 0.15, // Valor do juros de 1 dia'\r\n    'data_desconto'      => '2016-04-09', // informar a data neste formato\r\n    'vlr_desconto'       => '0', // Valor do desconto\r\n    'prazo'              => 5, // prazo de dias para o cliente pagar após o vencimento\r\n    'mensagem'           => 'JUROS de R$0,15 ao dia'.PHP_EOL.\"Não receber apos 30 dias\",\r\n    'email_pagador'         => 'rogerio@ciatec.net', // data da multa\r\n    'data_multa'         => '2016-04-09', // informar a data neste formato, // data da multa\r\n    'valor_multa'        => 30.00, // valor da multa\r\n));        \r\necho $arquivo->getText();\r\n```\r\n\r\n<line>\r\n<h3>Lendo retorno</h3>\r\n\r\n```php\r\n<?php\r\n$fileContent = file_get_contents(\"retorno_cnab240_caixa.ret\");\r\n\r\n$arquivo = new Retorno($fileContent);\r\n\r\n$registros = $arquivo->getRegistros();\r\nforeach($registros as $registro)\r\n{\r\n    if($registro->R3U->codigo_movimento==6){\r\n        $nossoNumero   = $registro->nosso_numero;\r\n        $valorRecebido = $registro->R3U->vlr_pago;\r\n        $dataPagamento = $registro->R3U->data_ocorrencia;\r\n        $carteira      = $registro->carteira;\r\n        // você ja pode dar baixa\r\n    }\r\n}\r\n```\r\n\r\nAgaurdando volutarios para edição e testes dos layouts.\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}